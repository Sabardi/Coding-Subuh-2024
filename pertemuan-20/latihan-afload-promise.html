<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Latihan Afload</title>
</head>
<body>
    <h1>Afload file dengan ajax</h1>
    <input type="file" name="file" id="fileInput">
    <button onclick="uploadFile()">Upload</button>
    <br>
    <progress id="progressBar" min="0" max="100" value="0"></progress>
    <span id="percenProgress"></span>

    <script>
        var progressBar = document.querySelector("#progressBar");
        var percenProgress = document.querySelector("percenProgress");

        function upload(UPLOAD_URL, formData) {
            return new Promise((resolve, reject)=> {
                // membuat objek xhr 
                const xhr = new XMLHttpRequest();

                // tambahkan event handling untk progress bar
                xhr.upload.addEventListener("progress", handleProgressUpload);

                // mendeteksi event load (request sukses dan selesai)
                xhr.onload = () =>{
                    if(xhr.status == 200){
                        resolve("Berhasil di upload");
                }else{
                    reject("terjadi kesalahan dalam upload file");
                }
            }

                xhr.onerror = () => reject("terjadi kesalahan upload file");

                xhr.open("POST", UPLOAD_URL, true);
                // send xhr 
                xhr.send(formData);
            });
        }

        function handleProgressUpload(event){
            if(event.lengthComputable){
                let persenComplete = (event.total * 100).toFixed();
                progressBar.value = persenComplete;
                percenProgress.textContent = persenComplete + "%";
                console.log(persenComplete + "% complete");
            }
        }

        async function uploadFile(){
            const UPLOAD_URL = "https://q6lg23-3000.csb.app//upload";
            const fileInput = document.querySelector("#fileInput");
            const file = fileInput.files[0]; // Mengambil file

            // membuat objek form data
            const formData = new FormData();
            formData.append('file', file); // Sesuaikan dengan key yang diterima di server

            try{
                const uploadPromise = await upload(UPLOAD_URL, formData)
                alert(await uploadPromise);
            }catch(error){
                console.log(error); //
            }
        }

    </script>
</body>
</html>